# Экспорт результатов сканирования

## Описание

Добавлен новый функционал экспорта результатов сканирования в форматы JSON и CSV с возможностью фильтрации.

## Новые возможности

### 1. Экспорт результатов
- **JSON формат** - структурированный формат для программной обработки
- **CSV формат** - табличный формат для работы в Excel и других редакторах
- **Оба формата** - одновременный экспорт в JSON и CSV

### 2. Фильтрация результатов
- **По IP** - фильтрация по IP-адресу или паттерну
- **По портам** - фильтрация по списку портов
- **По типам** - фильтрация по типу устройства (camera, auth, ftp, ssh, other)

### 3. Статистика
Экспортируемые файлы включают статистику по типам устройств и наиболее используемым портам.

## Использование

### Базовое использование

**Экспорт теперь включен по умолчанию в формате JSON!**

```bash
# Сканирование с автоматическим экспортом в JSON (по умолчанию)
./nesca --ip 192.168.1.0/24 -p 80,443

# Изменение формата экспорта
./nesca --ip 192.168.1.0/24 -p 80,443 --export csv

# Экспорт в оба формата
./nesca --ip 192.168.1.0/24 -p 80,443 --export both

# Отключение экспорта
./nesca --ip 192.168.1.0/24 -p 80,443 --no-export
```

### Экспорт существующих результатов

```bash
# Экспорт последних результатов (автоматически найдет последнюю директорию)
./nesca --export-only

# Экспорт из конкретной директории
./nesca --export-only results_2025.01.15_target

# С фильтрацией
./nesca --export-only --export-filter-type camera,auth --export csv
```

### Фильтрация результатов

```bash
# Экспорт только камер и результатов аутентификации
./nesca --ip 192.168.1.0/24 --export json --export-filter-type camera,auth

# Экспорт только определенных портов
./nesca --ip 192.168.1.0/24 --export csv --export-filter-port 80,8080,443

# Комбинированная фильтрация
./nesca --ip 192.168.1.0/24 --export both \
  --export-filter-ip 192.168.1 \
  --export-filter-port 80,443 \
  --export-filter-type camera
```

### Указание имени файла

```bash
# Автоматическое имя файла (export_YYYY.MM.DD_target)
./nesca --ip 192.168.1.0/24 --export json

# Указание своего имени файла
./nesca --ip 192.168.1.0/24 --export json --export-file my_results
```

## Формат экспорта

### JSON формат

```json
{
  "export_timestamp": "2025-01-15T12:00:00",
  "total_results": 150,
  "filtered_results": 45,
  "results": [
    {
      "ip": "192.168.1.1",
      "port": 80,
      "type": "camera",
      "timestamp": "Wed Jan 15 12:00:00 2025",
      "data": "Additional information...",
      "login": "",
      "password": ""
    }
  ],
  "statistics": {
    "by_type": {
      "camera": 30,
      "auth": 15,
      "other": 5
    },
    "top_ports": [
      {"port": 80, "count": 20},
      {"port": 443, "count": 15}
    ],
    "total": 150
  }
}
```

### CSV формат

```csv
IP,Port,Type,Timestamp,Data,Login,Password
192.168.1.1,80,camera,"Wed Jan 15 12:00:00 2025","Additional info...","",""
192.168.1.2,443,auth,"Wed Jan 15 12:01:00 2025","Web form","admin","password123"
```

## Опции командной строки

- `--export FORMAT` - Формат экспорта: `json` (по умолчанию), `csv`, или `both`
- `--no-export` - Отключить автоматический экспорт после сканирования
- `--export-only [DIR]` - Экспортировать существующие результаты без сканирования
- `--export-file FILE` - Имя выходного файла (без расширения)
- `--export-filter-ip IP` - Фильтр по IP-адресу или паттерну
- `--export-filter-port PORTS` - Фильтр по портам (через запятую)
- `--export-filter-type TYPES` - Фильтр по типам (через запятую)

### Важно:
- **Экспорт включен по умолчанию** в формате JSON после каждого сканирования
- Используйте `--no-export` если не нужен автоматический экспорт
- Используйте `--export-only` для экспорта результатов без нового сканирования

## Типы устройств

- `camera` - IP-камеры
- `auth` - Устройства с аутентификацией
- `ftp` - FTP-серверы
- `ssh` - SSH-серверы
- `other` - Прочие устройства

## Технические детали

- Результаты парсятся из HTML-файлов в директории `results_*/`
- Экспорт происходит автоматически после завершения сканирования
- Фильтры применяются во время экспорта, исходные HTML-файлы не изменяются
- Поддерживается UTF-8 кодировка для всех экспортируемых данных

