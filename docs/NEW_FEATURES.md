# Новые функции Nesca v2r

## 1. Статистика в реальном времени (Live Statistics)

### Описание
Во время сканирования отображается информация о прогрессе в реальном времени, которая обновляется каждые 2 секунды.

### Что отображается:
- **Процент выполнения** - процент отсканированных IP-адресов
- **Scanned** - количество отсканированных IP / общее количество
- **Found** - количество найденных устройств
- **Saved** - количество сохраненных результатов
- **По типам** - количество камер, устройств с аутентификацией, SSH и т.д.
- **Speed** - скорость сканирования (IP/сек)
- **Threads** - количество активных потоков
- **ETA** - примерное время до завершения

### Использование:

```bash
# По умолчанию включена
./nesca --ip 192.168.1.0/24 -p 80,443

# Явно включить
./nesca --ip 192.168.1.0/24 -p 80,443 --live-stats

# Отключить
./nesca --ip 192.168.1.0/24 -p 80,443 --no-live-stats
```

### Пример вывода:
```
[PROGRESS] 45.3% | Scanned: 453/1000 | Found: 23 | Saved: 15 | Cam:8 Auth:5 SSH:2 | Speed: 22.5 IP/s | Threads: 87 | ETA: 24m 15s
```

## 2. Определение типа устройств (Device Identification)

### Описание
Автоматическое определение производителя и модели IP-камер по заголовкам HTTP и содержимому страниц.

### Поддерживаемые производители:
- **Hikvision** - DS-, IPC-, DVR-, NVR- серии
- **Dahua** - IPC-, DHI-, DH- серии  
- **Axis** - P, M, Q серии
- **Panasonic** - WV-, BB- серии
- **Sony** - SNC-, IPELA серии
- **Samsung, Bosch, Pelco, Vivotek, Foscam, Uniview, Reolink, TP-Link** и другие

### Использование:
Функция автоматически интегрирована в процесс сканирования. Определение происходит при обнаружении устройств.

### API для разработчиков:

```cpp
#include "DeviceIdentifier.h"

// Полная информация об устройстве
DeviceInfo info = DeviceIdentifier::identify(headers, body);
// info.manufacturer - производитель
// info.model - модель
// info.firmware - версия прошивки
// info.deviceType - тип устройства (camera, dvr, nvr)
// info.confidence - уровень уверенности (high, medium, low)

// Получить только производителя
QString manufacturer = DeviceIdentifier::getManufacturer(headers, body);

// Проверить, является ли устройство определенной маркой
bool isHikvision = DeviceIdentifier::isBrand("Hikvision", headers, body);
```

## 3. Итоговая статистика после сканирования

### Описание
После завершения сканирования выводится подробная сводная статистика.

### Что отображается:
- **Duration** - длительность сканирования
- **Average Speed** - средняя скорость сканирования
- **Targets** - общее количество целей
- **Found** - найденные устройства с процентом успеха
- **Saved** - сохраненные результаты с процентом от найденных
- **By Type** - распределение по типам (камеры, аутентификация, SSH и т.д.)
- **Alive** - количество живых устройств
- **Filtered** - количество отфильтрованных результатов

### Пример вывода:
```
===========================================================
Scan Summary:
-----------------------------------------------------------
Duration:        125 seconds
Average Speed:   8.42 IPs/sec
Targets:         1054 total
Found:           47 nodes (4.46%)
Saved:           32 nodes (68.1%)

By Type:
  Cameras:       18
  Auth:          12
  SSH:           2
Alive:           47
===========================================================
```

## Комбинированное использование

```bash
# Полный набор функций: живая статистика + экспорт + итоговая сводка
./nesca --ip 192.168.1.0/24 -p 80,443,8080 --export both --live-stats

# Экспорт с фильтрацией только камер
./nesca --export-only --export-filter-type camera --export json

# Сканирование без живой статистики (для старых терминалов)
./nesca --ip 192.168.1.0/24 -p 80,443 --no-live-stats
```

## Технические детали

- **Производительность**: Мониторинг прогресса работает в отдельном потоке и не замедляет сканирование
- **Совместимость**: Поддерживаются все терминалы с ANSI цветами
- **Точность**: Определение устройств основано на анализе HTTP-заголовков и содержимого страниц
- **Расширяемость**: Легко добавить новые производители через DeviceIdentifier

## 4. Управление конфигурацией (Configuration Management)

### Описание
Система управления конфигурацией позволяет сохранять и повторно использовать настройки сканирования через файлы конфигурации и профили.

### Возможности:
- **Конфигурационные файлы** - сохранение настроек в `.conf` файлах
- **Предустановленные профили** - быстрая настройка для различных сценариев
- **Объединение настроек** - комбинация конфигурации и аргументов командной строки (CLI имеет приоритет)

### Предустановленные профили:

1. **quick-scan** - Быстрое сканирование
   - Порты: 80, 443, 8080
   - Потоки: 100
   - Таймаут: 3000ms

2. **full-scan** - Полное сканирование
   - Расширенный набор портов
   - Глубокое сканирование включено
   - Определение версий сервисов

3. **stealth-scan** - Скрытное сканирование
   - Ограниченная скорость запросов
   - Увеличенные таймауты
   - Минимальная нагрузка на сеть

4. **iot-scan** - Сканирование IoT устройств
   - Оптимизированные порты для IoT
   - Умное сканирование включено

5. **network-scan** - Сканирование сетевого оборудования
   - Порты: 80, 443, 8080, 8291, 8443
   - Адаптивное сканирование

6. **pentest** - Профиль для пентестинга
   - Расширенные возможности обнаружения
   - Проверка уязвимостей

### Использование:

```bash
# Использование профиля
./nesca --ip 192.168.1.0/24 --profile quick-scan

# Загрузка конфигурационного файла
./nesca --ip 192.168.1.0/24 --config custom.conf

# Комбинирование профиля и CLI аргументов (CLI имеет приоритет)
./nesca --ip 192.168.1.0/24 --profile full-scan -p 80,443,8080

# Просмотр доступных профилей
./nesca --help | grep profile
```

### Формат конфигурационного файла:

```ini
[scan]
threads = 200
ports = 80,443,8080,554
timeout = 5000
max_rate = 100
retries = 2
verify_ssl = false
adaptive = true
smart_scan = true
batch_size = 50
shuffle = true
user_agent = CustomAgent/1.0
tld = .com

[detection]
deep_scan = true
check_vulnerabilities = true
enable_fingerprinting = true
enabled_detectors = onvif,rtsp,manufacturer,snmp

[export]
format = json,csv
auto_export = true
output_file = results
filter_ip = 
filter_ports = 
filter_types = camera,auth
auto_open = false
```

### Файлы конфигурации:
Конфигурационные файлы можно разместить в:
- Текущей директории: `./quick-scan.conf`
- Директории `configs/`: `configs/quick-scan.conf`
- Абсолютный путь: `--config /path/to/config.conf`

## 5. Интерактивный режим (Interactive Mode)

### Описание
Интерактивный режим с меню для упрощенной настройки и запуска сканирования без необходимости запоминать все аргументы командной строки.

### Возможности:
- **Интерактивное меню** - выбор режима сканирования через меню
- **Быстрые пресеты** - готовые настройки для типовых задач
- **Пошаговая настройка** - настройка параметров через диалоги
- **Визуальная обратная связь** - прогресс-бар и цветной вывод

### Использование:

```bash
# Запуск интерактивного режима
./nesca --interactive

# Быстрые пресеты (без меню)
./nesca --quick-camera-scan      # Быстрое сканирование камер
./nesca --quick-server-scan      # Быстрое сканирование серверов
./nesca --quick-network-scan     # Быстрое сканирование сетевого оборудования
./nesca --quick-iot-scan         # Быстрое сканирование IoT устройств
```

### Быстрые пресеты:

**quick-camera-scan**
- Порты: 80, 8080, 554, 8554
- Потоки: 150
- Умное сканирование включено

**quick-server-scan**
- Порты: 22, 80, 443, 3389, 5985, 5986
- Потоки: 200
- Адаптивное сканирование включено

**quick-network-scan**
- Порты: 80, 443, 8080, 8291, 8443
- Потоки: 150
- Адаптивное и умное сканирование

**quick-iot-scan**
- Порты: 80, 8080, 8081, 8443
- Потоки: 100
- Умное сканирование включено

## 6. Адаптивное сканирование (Adaptive Scanning)

### Описание
Система автоматической оптимизации количества потоков на основе текущей нагрузки сети, времени отклика и процента таймаутов.

### Как это работает:
- **Мониторинг метрик** - отслеживание времени отклика, процента успешных запросов и таймаутов
- **Автоматическая корректировка** - изменение количества потоков каждые 5 секунд
- **Оптимизация** - поддержание оптимального баланса между скоростью и стабильностью

### Использование:

```bash
# Включить адаптивное сканирование
./nesca --ip 192.168.1.0/24 -p 80,443 --adaptive

# Адаптивное сканирование с начальным количеством потоков
./nesca --ip 192.168.1.0/24 -p 80,443 --adaptive -t 200

# В профиле
./nesca --ip 192.168.1.0/24 --profile full-scan  # adaptive включен в профиле
```

### Метрики адаптации:
- **Среднее время отклика** - отслеживается скользящее среднее за последние 100 запросов
- **Процент таймаутов** - целевой уровень: до 10% допустимо
- **Диапазон потоков** - от 10 до 2000 потоков
- **Интервал корректировки** - каждые 5 секунд

### Пример работы:
```
[Adaptive] Adjusted threads: 200 -> 150 (timeout rate: 12%, avg response: 850ms)
[Adaptive] Adjusted threads: 150 -> 120 (timeout rate: 8%, avg response: 450ms)
```

## 7. Умное сканирование (Smart Scan)

### Описание
Приоритизация портов для IP-адресов, на которых уже были найдены устройства. Это позволяет быстрее находить все доступные сервисы на активных устройствах.

### Как это работает:
1. При обнаружении устройства на определенном порту, IP-адрес запоминается
2. Для этого IP приоритет отдается популярным портам (80, 443, 8080, 554 и т.д.)
3. Эти порты сканируются первыми, что ускоряет обнаружение всех сервисов

### Использование:

```bash
# Включить умное сканирование
./nesca --ip 192.168.1.0/24 -p 80,443,8080 --smart-scan

# Комбинирование с адаптивным сканированием
./nesca --ip 192.168.1.0/24 -p 80,443 --adaptive --smart-scan
```

### Преимущества:
- Быстрее находит все сервисы на активных устройствах
- Уменьшает нагрузку на неактивные IP-адреса
- Оптимизирует последовательность сканирования

## 8. Глубокое сканирование (Deep Scan)

### Описание
После обнаружения устройства автоматически сканирует дополнительные пути, поддомены и альтернативные порты для получения максимальной информации об устройстве.

### Возможности:
- **Сканирование путей** - автоматический поиск общих эндпоинтов (например, `/config`, `/api`, `/status`)
- **Определение версии прошивки** - извлечение информации о версии прошивки
- **Обнаружение форм и ссылок** - анализ HTML для поиска доступных функций
- **Альтернативные порты** - сканирование популярных альтернативных портов

### Использование:

```bash
# Включить глубокое сканирование
./nesca --ip 192.168.1.0/24 -p 80,443 --deep-scan

# В конфигурации
./nesca --ip 192.168.1.0/24 --config full-scan.conf  # deep_scan = true
```

### Пример результатов:
```
[Deep Scan] Found 8 endpoints: /config, /api/status, /cgi-bin, /admin, /system
[Firmware] V5.6.0 build 191220
```

## 9. Сканирование уязвимостей (Vulnerability Scanning)

### Описание
Автоматическая проверка обнаруженных устройств на наличие известных уязвимостей из базы данных CVE.

### Возможности:
- **База данных CVE** - проверка против известных уязвимостей
- **Целевые проверки** - специфичные проверки для популярных производителей
- **Классификация** - классификация по уровню критичности (Critical, High, Medium, Low)
- **Подтверждение** - попытка подтвердить наличие уязвимости на устройстве

### Поддерживаемые проверки:
- CVE-2021-36260 (Hikvision) - Command Injection
- CVE-2021-33045 (Dahua) - Authentication Bypass
- CVE-2017-7921 (Hikvision) - Authentication Bypass
- CVE-2021-34991 (Hikvision) - Command Injection
- CVE-2022-30525 (Zyxel) - Command Injection

### Использование:

```bash
# Включить сканирование уязвимостей
./nesca --ip 192.168.1.0/24 -p 80,443 --vuln-scan

# Комбинирование с глубоким сканированием
./nesca --ip 192.168.1.0/24 -p 80,443 --deep-scan --vuln-scan

# В конфигурации (pentest профиль)
./nesca --ip 192.168.1.0/24 --profile pentest
```

### Формат результатов:
```
[VULN] 192.168.1.100:80 - CVE-2021-36260 (Critical, CVSS: 9.8)
  Hikvision Command Injection vulnerability
  Affected: Firmware < V5.7.0
```

## 10. Определение версий сервисов (Service Version Detection)

### Описание
Автоматическое определение точных версий прошивок и сервисов на обнаруженных устройствах.

### Использование:

```bash
# Включить определение версий
./nesca --ip 192.168.1.0/24 -p 80,443 --service-version
```

## 11. Цветной вывод (Color Output)

### Описание
Добавлена поддержка цветного вывода для улучшения читаемости информации в терминале.

### Использование:

```bash
# Включить цветной вывод (если терминал поддерживает)
./nesca --ip 192.168.1.0/24 -p 80,443 --color

# В интерактивном режиме цвет включен автоматически
./nesca --interactive
```

## Комбинированное использование

```bash
# Полный набор функций: живая статистика + экспорт + итоговая сводка
./nesca --ip 192.168.1.0/24 -p 80,443,8080 --export both --live-stats

# Профиль с адаптивным и умным сканированием
./nesca --ip 192.168.1.0/24 --profile full-scan --adaptive --smart-scan

# Глубокое сканирование с проверкой уязвимостей
./nesca --ip 192.168.1.0/24 -p 80,443 --deep-scan --vuln-scan --service-version

# Быстрое сканирование камер с экспортом
./nesca --quick-camera-scan --export json

# Интерактивный режим
./nesca --interactive

# Конфигурация с переопределением параметров
./nesca --ip 192.168.1.0/24 --config custom.conf -p 80,443 -t 300
```

## Технические детали

### Производительность
- **Мониторинг прогресса**: работает в отдельном потоке и не замедляет сканирование
- **Адаптивное сканирование**: автоматическая оптимизация каждые 5 секунд
- **Умное сканирование**: ускоряет обнаружение сервисов на активных устройствах
- **Глубокое сканирование**: выполняется асинхронно после основного сканирования

### Совместимость
- Поддерживаются все терминалы с ANSI цветами
- Конфигурационные файлы используют стандартный INI формат
- Профили совместимы между версиями

### Точность
- **Определение устройств**: основано на анализе HTTP-заголовков и содержимого страниц
- **Сканирование уязвимостей**: использует актуальную базу CVE
- **Определение версий**: извлекает версии из заголовков и метаданных

### Расширяемость
- Легко добавить новые производители через DeviceIdentifier
- Новые профили можно создать через конфигурационные файлы
- Новые проверки уязвимостей добавляются в VulnerabilityScanner
- Быстрые пресеты расширяются через InteractiveMode

## Преимущества

1. **Видимость прогресса** - всегда знаете, сколько осталось до завершения
2. **Оптимизация** - видите скорость работы и можете скорректировать параметры
3. **Информативность** - знаете, какие устройства найдены и их типы
4. **Автоматизация** - определение производителей помогает в автоматической обработке результатов
5. **Гибкость** - конфигурационные файлы позволяют сохранять и переиспользовать настройки
6. **Удобство** - интерактивный режим упрощает использование для новичков
7. **Эффективность** - адаптивное и умное сканирование оптимизируют использование ресурсов
8. **Безопасность** - сканирование уязвимостей помогает выявить проблемы безопасности

