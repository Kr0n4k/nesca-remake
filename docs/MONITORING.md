# Режим мониторинга сети

Nesca поддерживает непрерывный мониторинг сети с отслеживанием изменений и оповещениями.

## Использование

### Базовое использование

```bash
# Мониторинг с интервалом 5 минут (по умолчанию)
./nesca --ip 192.168.1.0/24 --monitor

# Мониторинг с кастомным интервалом (в секундах)
./nesca --ip 192.168.1.0/24 --monitor 600  # 10 минут

# Мониторинг с отображением изменений
./nesca --ip 192.168.1.0/24 --monitor --diff

# Мониторинг с оповещениями о новых устройствах
./nesca --ip 192.168.1.0/24 --monitor --alert-new-device

# Полный набор функций мониторинга
./nesca --ip 192.168.1.0/24 --monitor 300 --diff --alert-new-device
```

## Параметры

### `--monitor [INTERVAL]`
Включает режим постоянного мониторинга. Опционально можно указать интервал между сканированиями в секундах (по умолчанию: 300 секунд = 5 минут).

### `--diff`
Показывает различия между текущим и предыдущим сканированием:
- Новые устройства (добавлены)
- Удаленные устройства (больше не доступны)
- Измененные устройства (изменилась информация)

### `--alert-new-device`
Включает оповещения о новых устройствах. При обнаружении нового устройства выводится предупреждение с подробной информацией.

## Как это работает

1. **Первое сканирование**: Выполняется обычное сканирование сети
2. **Создание snapshot**: Результаты сохраняются в виде snapshot (JSON файл)
3. **Периодическое сканирование**: Через указанный интервал выполняется новое сканирование
4. **Сравнение**: Новые результаты сравниваются с предыдущим snapshot
5. **Оповещения**: При наличии изменений выводится информация (если `--diff` или `--alert-new-device`)

## Формат snapshots

Snapshots сохраняются в формате JSON в директории:
```
~/.local/share/nesca/TARGET_NAME/snapshot_YYYYMMDD_HHMMSS.json
```

Пример snapshot:
```json
{
  "timestamp": "2025-10-28T21:30:00",
  "scanTarget": "192.168.1.0/24",
  "mode": "ip",
  "totalDevices": 10,
  "newDevices": 2,
  "removedDevices": 1,
  "changedDevices": 0,
  "devices": {
    "192.168.1.1:80": {
      "ip": "192.168.1.1",
      "port": 80,
      "deviceType": "router",
      "manufacturer": "MikroTik",
      "model": "RouterBoard RB750",
      "firmware": "6.45",
      "firstSeen": "2025-10-28T20:00:00",
      "lastSeen": "2025-10-28T21:30:00",
      "scanCount": 3
    }
  }
}
```

## Примеры вывода

### С флагом `--diff`:
```
=== Network Changes ===
New devices: 2
Removed devices: 1
Changed devices: 0

--- New Devices ---
  + 192.168.1.100:80 (TP-Link Archer C7) [router]
  + 192.168.1.50:8080 (Yeelight) [smart_bulb]

--- Removed Devices ---
  - 192.168.1.99:443 (Unknown)
```

### С флагом `--alert-new-device`:
```
[ALERT] NEW DEVICE DETECTED!
  IP: 192.168.1.100:80
  Manufacturer: TP-Link
  Model: Archer C7
  Type: router
  First seen: 2025-10-28T21:30:00
```

## Остановка мониторинга

Нажмите `Ctrl+C` для корректной остановки. Все snapshots будут сохранены перед завершением.

## Совместимость с другими режимами

Режим мониторинга работает со всеми режимами сканирования:
- `--ip` - мониторинг IP диапазона
- `--dns` - мониторинг DNS масок
- `--import` - мониторинг списка IP из файла

Также совместим с:
- Конфигурационными файлами (`--config`, `--profile`)
- Адаптивным сканированием (`--adaptive`)
- Умным сканированием (`--smart-scan`)
- Экспортом результатов (`--export`)

## Примеры сценариев

### Мониторинг офисной сети
```bash
./nesca --ip 192.168.1.0/24 --monitor 3600 --diff --alert-new-device
# Сканирование каждый час с оповещениями
```

### Быстрый мониторинг IoT устройств
```bash
./nesca --ip 192.168.1.0/24 --profile iot-scan --monitor 180 --diff
# Сканирование каждые 3 минуты с IoT профилем
```

### Скрытный мониторинг
```bash
./nesca --ip 10.0.0.0/24 --profile stealth-scan --monitor 1800 --no-export
# Сканирование каждые 30 минут в скрытом режиме без экспорта
```

## Ограничения

- Минимальный интервал: 60 секунд (рекомендуется не менее 300 секунд)
- Snapshots хранятся неограниченно долго (может потребоваться ручная очистка)
- При больших сетях каждый snapshot может быть довольно объемным

## Будущие улучшения

- Автоматическая очистка старых snapshots
- Веб-интерфейс для просмотра истории мониторинга
- Email/SMS оповещения о новых устройствах
- Экспорт истории мониторинга в CSV/JSON

