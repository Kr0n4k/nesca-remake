# Структура проекта Nesca v2r

## Обзор

Этот документ описывает структуру проекта и организацию исходного кода.

## Структура директорий

```
nesca-v2r/
│
├── docs/                          # Документация проекта
│   ├── EXPORT_FEATURE.md          # Руководство по экспорту результатов
│   ├── NEW_FEATURES.md            # Описание новых функций
│   ├── BUILD_INSTRUCTIONS.md      # Инструкции по сборке
│   └── PROJECT_STRUCTURE.md       # Этот файл
│
├── scripts/                       # Вспомогательные скрипты
│   ├── build.sh                   # Скрипт сборки для Linux/macOS
│   ├── build.bat                  # Скрипт сборки для Windows
│   ├── run.sh                     # Скрипт запуска
│   ├── create.sh                  # Вспомогательный скрипт
│   └── generator.py               # Генератор IP-диапазонов
│
├── resources/                     # Ресурсы приложения
│   ├── fonts/                     # Шрифты
│   │   ├── Eurostile.ttf
│   │   └── small_font.ttf
│   ├── icons/                     # Иконки
│   │   └── nesca.ico
│   └── images/                    # Изображения
│       └── 1.jpg
│
├── tests/                         # Тестовые файлы
│   ├── test_*.cpp                 # Тестовые исходники
│   └── test_*.txt                 # Тестовые данные
│
├── pwd_lists/                     # Списки паролей для брутфорса
│   ├── login.txt                  # Логины
│   ├── pass.txt                   # Пароли
│   ├── ftplogin.txt              # FTP логины
│   ├── ftppass.txt               # FTP пароли
│   ├── wflogin.txt               # Web-form логины
│   ├── wfpass.txt                # Web-form пароли
│   └── sshpass.txt               # SSH пароли
│
├── results_*/                     # Результаты сканирования (генерируется)
│   └── [date]_[target]/
│       ├── camera.html            # Найденные камеры
│       ├── auth.html              # Устройства с аутентификацией
│       ├── ftp.html               # FTP серверы
│       ├── ssh.html               # SSH серверы
│       └── other.html             # Прочие устройства
│
└── Корневая директория            # Исходный код
    │
    ├── Основные файлы
    │   ├── main.cpp               # Главная точка входа (console mode)
    │   ├── main_console.cpp       # Альтернативный console mode
    │   └── nesca_3.cpp            # GUI версия (основной файл UI)
    │
    ├── Ядро системы
    │   ├── MainStarter.h/cpp      # Инициализация и запуск сканирования
    │   ├── STh.h/cpp              # Основной поток сканирования
    │   ├── Threader.h/cpp         # Управление потоками
    │   ├── Connector.h/cpp        # Сетевое подключение
    │   └── finder.cpp             # Поиск и обработка результатов
    │
    ├── Аутентификация
    │   ├── BasicAuth.h/cpp        # HTTP Basic Authentication
    │   ├── FTPAuth.h/cpp          # FTP аутентификация
    │   ├── SSHAuth.h/cpp          # SSH подключения
    │   ├── IPCAuth.h/cpp          # IPC камеры
    │   ├── HikvisionLogin.h/cpp   # Hikvision SDK
    │   ├── RTSP.h/cpp             # RTSP протокол
    │   ├── WebformWorker.h/cpp    # Web-формы аутентификация
    │   └── BruteUtils.h/cpp       # Утилиты для брутфорса
    │
    ├── Экспорт и анализ
    │   ├── ResultExporter.h/cpp   # Экспорт в JSON/CSV
    │   ├── DeviceIdentifier.h/cpp # Определение типов устройств
    │   └── ProgressMonitor.h/cpp  # Мониторинг прогресса
    │
    ├── Утилиты
    │   ├── Utils.h/cpp            # Общие утилиты
    │   ├── base64.h/cpp           # Base64 кодирование
    │   ├── IPRandomizer.h/cpp     # Рандомизация IP
    │   ├── FileDownloader.h/cpp   # Загрузка файлов
    │   └── FileUpdater.h/cpp      # Обновление файлов
    │
    ├── GUI компоненты (Qt Widgets)
    │   ├── nesca_3.h/cpp          # Главное окно
    │   ├── nesca_3.ui             # UI определение
    │   ├── piestat.h/cpp          # Статистика в виде диаграммы
    │   ├── progressbardrawer.h/cpp# Отрисовка прогресс-бара
    │   ├── ActivityDrawerTh_HorNet.h/cpp
    │   ├── DrawerTh_*.h/cpp       # Различные сканеры
    │   ├── msgcheckerthread.h/cpp # Проверка сообщений
    │   └── vercheckerthread.h/cpp # Проверка версий
    │
    ├── Конфигурация и ресурсы
    │   ├── nesca.pro              # Qt проект (console mode)
    │   ├── nesca_3.pro            # Qt проект (GUI mode)
    │   │   ├── mainResources.h      # Основные ресурсы и константы
    │   ├── externData.h            # Глобальные переменные
    │   ├── externFunctions.h       # Глобальные функции
    │   ├── resource.h              # Ресурсы Windows
    │   └── nesca_3.qrc             # Qt ресурсы
    │
    └── Вспомогательные файлы
        ├── README.md               # Основная документация
        ├── .gitignore             # Git ignore правила
        ├── Dockerfile             # Docker конфигурация
        ├── version                # Версия приложения
        └── restore                # Восстановление настроек
```

## Основные модули

### 1. Ядро системы (Core)

**MainStarter** - Основной класс для инициализации и управления сканированием:
- Загрузка целей и портов
- Запуск различных режимов сканирования (IP/DNS/Import)
- Управление вспомогательными потоками
- Сохранение резервных копий

**STh** - Основной поток сканирования:
- Координация работы всех модулей
- Эмиссия сигналов для GUI (если используется)
- Управление жизненным циклом сканирования

**Threader** - Управление потоками:
- Пулы потоков для параллельного сканирования
- Оптимизация использования ресурсов
- Синхронизация доступа

### 2. Аутентификация

Все модули аутентификации работают независимо:
- **BasicAuth** - HTTP Basic Authentication
- **FTPAuth** - FTP соединения и брутфорс
- **SSHAuth** - SSH подключения
- **IPCAuth** - IP камеры
- **HikvisionLogin** - Интеграция с Hikvision SDK
- **RTSP** - RTSP протокол для видеопотоков
- **WebformWorker** - Автоматизация web-форм

### 3. Экспорт и анализ

**ResultExporter** - Экспорт результатов:
- Парсинг HTML результатов
- Экспорт в JSON/CSV
- Фильтрация по различным критериям
- Статистика

**DeviceIdentifier** - Определение устройств:
- Распознавание производителей
- Определение моделей
- Классификация типов устройств

**ProgressMonitor** - Мониторинг прогресса:
- Живая статистика в реальном времени
- Расчет скорости сканирования
- Оценка времени до завершения

### 4. Утилиты

**Utils** - Общие утилиты:
- Работа со строками
- Обработка дат и времени
- Различные вспомогательные функции

**IPRandomizer** - Рандомизация:
- Перемешивание IP-адресов для сканирования
- Оптимизация последовательности

## Глобальные данные

**externData.h** - Содержит:
- Глобальные переменные состояния
- Константы конфигурации
- Счетчики и статистику

**mainResources.h** - Содержит:
- Макросы для типов устройств
- Пути к файлам
- HTTP стили и шаблоны

## Режимы работы

### Console Mode (main.cpp)
- Упрощенный интерфейс командной строки
- Автоматический экспорт результатов
- Живая статистика
- Фокус на производительности

### GUI Mode (nesca_3.cpp)
- Полнофункциональный графический интерфейс
- Визуализация результатов
- Интерактивная статистика
- Расширенные настройки

## Потоки данных

1. **Сканирование**:
   ```
   MainStarter → Threader → Connector → [Auth modules] → finder → HTML files
   ```

2. **Экспорт**:
   ```
   HTML files → ResultExporter → JSON/CSV files
   ```

3. **Статистика**:
   ```
   Global counters → ProgressMonitor → Console output
   ```

## Сборка

Проект использует Qt qmake для сборки:
- **nesca.pro** - для console mode
- **nesca_3.pro** - для GUI mode

Компиляция создает:
- Исполняемый файл
- MOC файлы (moc_*.cpp)
- UI заголовки (ui_*.h)
- QRC файлы (qrc_*.cpp)

## Рекомендации для разработчиков

1. **Новые модули аутентификации**: Добавляйте в директорию корня проекта или создайте поддиректорию `auth/`

2. **Новые утилиты**: Добавляйте в корень или создайте `utils/`

3. **Тесты**: Помещайте в директорию `tests/`

4. **Документация**: Всегда обновляйте соответствующие .md файлы в `docs/`

5. **Константы**: Используйте `mainResources.h` для констант, связанных с типами устройств

6. **Глобальные переменные**: Добавляйте в `externData.h` только при необходимости

## Зависимости

- **Qt5 Core/Network** - основные библиотеки
- **libssh** - SSH подключения
- **OpenSSL** - SSL/TLS
- **libcurl** - HTTP запросы

## Следующие шаги для улучшения структуры

- [ ] Организовать исходники в поддиректории (src/core, src/auth, src/export)
- [ ] Создать CMakeLists.txt для альтернативной сборки
- [ ] Добавить unit-тесты
- [ ] Создать конфигурационные файлы для CI/CD
- [ ] Добавить примеры использования в docs/examples/

