# Структура проекта Nesca v2r

## Обзор

Этот документ описывает структуру проекта и организацию исходного кода.

## Структура директорий

```
nesca-v2r/
│
├── docs/                          # Документация проекта
│   ├── EXPORT_FEATURE.md          # Руководство по экспорту результатов
│   ├── NEW_FEATURES.md            # Описание новых функций
│   ├── BUILD_INSTRUCTIONS.md      # Инструкции по сборке
│   └── PROJECT_STRUCTURE.md       # Этот файл
│
├── scripts/                       # Вспомогательные скрипты
│   ├── build.sh                   # Скрипт сборки для Linux/macOS
│   ├── build.bat                  # Скрипт сборки для Windows
│   ├── run.sh                     # Скрипт запуска
│   ├── create.sh                  # Вспомогательный скрипт
│   └── generator.py               # Генератор IP-диапазонов
│
├── configs/                       # Конфигурационные файлы и профили
│   ├── quick-scan.conf            # Профиль быстрого сканирования
│   ├── full-scan.conf             # Профиль полного сканирования
│   ├── stealth-scan.conf          # Профиль скрытного сканирования
│   ├── iot-scan.conf              # Профиль сканирования IoT
│   ├── network-scan.conf          # Профиль сканирования сетевого оборудования
│   └── pentest.conf               # Профиль для пентестинга
│
├── resources/                     # Ресурсы приложения
│   ├── fonts/                     # Шрифты
│   │   ├── Eurostile.ttf
│   │   └── small_font.ttf
│   ├── icons/                     # Иконки
│   │   └── nesca.ico
│   └── images/                    # Изображения
│       └── 1.jpg
│
├── tests/                         # Тестовые файлы
│   ├── test_*.cpp                 # Тестовые исходники
│   └── test_*.txt                 # Тестовые данные
│
├── pwd_lists/                     # Списки паролей для брутфорса
│   ├── login.txt                  # Логины
│   ├── pass.txt                   # Пароли
│   ├── ftplogin.txt              # FTP логины
│   ├── ftppass.txt               # FTP пароли
│   ├── wflogin.txt               # Web-form логины
│   ├── wfpass.txt                # Web-form пароли
│   └── sshpass.txt               # SSH пароли
│
├── results_*/                     # Результаты сканирования (генерируется)
│   └── [date]_[target]/
│       ├── camera.html            # Найденные камеры
│       ├── auth.html              # Устройства с аутентификацией
│       ├── ftp.html               # FTP серверы
│       ├── ssh.html               # SSH серверы
│       └── other.html             # Прочие устройства
│
└── Корневая директория            # Исходный код
    │
    ├── Основные файлы
    │   ├── main.cpp               # Главная точка входа (console mode)
    │   ├── main_console.cpp       # Альтернативный console mode
    │   └── nesca_3.cpp            # GUI версия (основной файл UI)
    │
    ├── Ядро системы
    │   ├── MainStarter.h/cpp      # Инициализация и запуск сканирования
    │   ├── STh.h/cpp              # Основной поток сканирования
    │   ├── Threader.h/cpp         # Управление потоками
    │   ├── Connector.h/cpp        # Сетевое подключение
    │   └── finder.cpp             # Поиск и обработка результатов
    │
    ├── Аутентификация
    │   ├── BasicAuth.h/cpp        # HTTP Basic Authentication
    │   ├── FTPAuth.h/cpp          # FTP аутентификация
    │   ├── SSHAuth.h/cpp          # SSH подключения
    │   ├── IPCAuth.h/cpp          # IPC камеры
    │   ├── HikvisionLogin.h/cpp   # Hikvision SDK
    │   ├── RTSP.h/cpp             # RTSP протокол
    │   ├── WebformWorker.h/cpp    # Web-формы аутентификация
    │   └── BruteUtils.h/cpp       # Утилиты для брутфорса
    │
    ├── Экспорт и анализ
    │   ├── ResultExporter.h/cpp   # Экспорт в JSON/CSV
    │   ├── DeviceIdentifier.h/cpp # Определение типов устройств
    │   └── ProgressMonitor.h/cpp  # Мониторинг прогресса
    │
    ├── Детекторы и сканеры
    │   ├── DeepScanner.h/cpp      # Глубокое сканирование путей/эндпоинтов
    │   ├── VulnerabilityScanner.h/cpp  # Сканирование уязвимостей (CVE)
    │   ├── ServiceVersionDetector.h/cpp # Определение версий сервисов
    │   ├── FingerprintScanner.h/cpp    # Фингерпринтинг устройств
    │   └── AdaptiveScanner.h/cpp       # Адаптивное и умное сканирование
    │
    ├── Утилиты
    │   ├── Utils.h/cpp            # Общие утилиты
    │   ├── base64.h/cpp           # Base64 кодирование
    │   ├── IPRandomizer.h/cpp     # Рандомизация IP
    │   ├── FileDownloader.h/cpp   # Загрузка файлов
    │   └── FileUpdater.h/cpp      # Обновление файлов
    │
    ├── Конфигурация и мониторинг
    │   ├── ConfigManager.h/cpp    # Управление конфигурацией
    │   └── NetworkMonitor.h/cpp   # Мониторинг сети
    │
    ├── GUI компоненты (Qt Widgets)
    │   ├── nesca_3.h/cpp          # Главное окно
    │   ├── nesca_3.ui             # UI определение
    │   ├── piestat.h/cpp          # Статистика в виде диаграммы
    │   ├── progressbardrawer.h/cpp# Отрисовка прогресс-бара
    │   ├── ActivityDrawerTh_HorNet.h/cpp
    │   ├── DrawerTh_*.h/cpp       # Различные сканеры
    │   ├── msgcheckerthread.h/cpp # Проверка сообщений
    │   ├── vercheckerthread.h/cpp # Проверка версий
    │   └── InteractiveMode.h/cpp  # Интерактивный режим консоли
    │
    ├── Конфигурация и ресурсы
    │   ├── nesca.pro              # Qt проект (console mode)
    │   ├── nesca_3.pro            # Qt проект (GUI mode)
    │   │   ├── mainResources.h      # Основные ресурсы и константы
    │   ├── externData.h            # Глобальные переменные
    │   ├── externFunctions.h       # Глобальные функции
    │   ├── resource.h              # Ресурсы Windows
    │   └── nesca_3.qrc             # Qt ресурсы
    │
    └── Вспомогательные файлы
        ├── README.md               # Основная документация
        ├── .gitignore             # Git ignore правила
        ├── Dockerfile             # Docker конфигурация
        ├── version                # Версия приложения
        └── restore                # Восстановление настроек
```

## Основные модули

### 1. Ядро системы (Core)

**MainStarter** - Основной класс для инициализации и управления сканированием:
- Загрузка целей и портов
- Запуск различных режимов сканирования (IP/DNS/Import)
- Управление вспомогательными потоками
- Сохранение резервных копий

**STh** - Основной поток сканирования:
- Координация работы всех модулей
- Эмиссия сигналов для GUI (если используется)
- Управление жизненным циклом сканирования

**Threader** - Управление потоками:
- Пулы потоков для параллельного сканирования
- Оптимизация использования ресурсов
- Синхронизация доступа

### 2. Аутентификация

Все модули аутентификации работают независимо:
- **BasicAuth** - HTTP Basic Authentication
- **FTPAuth** - FTP соединения и брутфорс
- **SSHAuth** - SSH подключения
- **IPCAuth** - IP камеры
- **HikvisionLogin** - Интеграция с Hikvision SDK
- **RTSP** - RTSP протокол для видеопотоков
- **WebformWorker** - Автоматизация web-форм

### 3. Экспорт и анализ

**ResultExporter** - Экспорт результатов:
- Парсинг HTML результатов
- Экспорт в JSON/CSV
- Фильтрация по различным критериям
- Статистика

**DeviceIdentifier** - Определение устройств:
- Распознавание производителей
- Определение моделей
- Классификация типов устройств

**ProgressMonitor** - Мониторинг прогресса:
- Живая статистика в реальном времени
- Расчет скорости сканирования
- Оценка времени до завершения

### 4. Детекторы и сканеры

**DeepScanner** - Глубокое сканирование:
- Сканирование путей и эндпоинтов
- Определение версии прошивки
- Обнаружение форм и ссылок
- Сканирование альтернативных портов

**VulnerabilityScanner** - Сканирование уязвимостей:
- База данных CVE
- Целевые проверки для производителей
- Классификация по критичности
- Подтверждение уязвимостей

**ServiceVersionDetector** - Определение версий:
- Извлечение версий из заголовков
- Определение версий прошивок
- Анализ метаданных

**FingerprintScanner** - Фингерпринтинг:
- Детальное определение устройств
- Анализ отпечатков

**AdaptiveScanner** - Адаптивное сканирование:
- Автоматическая оптимизация потоков
- Мониторинг метрик сети
- Умное сканирование (приоритизация портов)
- Батч-обработка

### 5. Конфигурация и мониторинг

**ConfigManager** - Управление конфигурацией:
- Загрузка конфигурационных файлов
- Управление профилями
- Объединение настроек (CLI + config)
- Валидация конфигурации
- Сохранение конфигурации

**NetworkMonitor** - Мониторинг сети:
- Непрерывное сканирование
- Сравнение результатов (snapshots)
- Оповещения о новых устройствах
- Отслеживание изменений

### 6. Утилиты

**Utils** - Общие утилиты:
- Работа со строками
- Обработка дат и времени
- Различные вспомогательные функции

**IPRandomizer** - Рандомизация:
- Перемешивание IP-адресов для сканирования
- Оптимизация последовательности

### 7. GUI компоненты

**InteractiveMode** - Интерактивный режим:
- Интерактивное меню
- Быстрые пресеты
- Пошаговая настройка
- Цветной вывод
- Прогресс-бар

## Глобальные данные

**externData.h** - Содержит:
- Глобальные переменные состояния
- Константы конфигурации
- Счетчики и статистику

**mainResources.h** - Содержит:
- Макросы для типов устройств
- Пути к файлам
- HTTP стили и шаблоны

## Режимы работы

### Console Mode (main.cpp)
- Упрощенный интерфейс командной строки
- Автоматический экспорт результатов
- Живая статистика
- Фокус на производительности

### GUI Mode (nesca_3.cpp)
- Полнофункциональный графический интерфейс
- Визуализация результатов
- Интерактивная статистика
- Расширенные настройки

## Потоки данных

1. **Сканирование**:
   ```
   MainStarter → ConfigManager → Threader → AdaptiveScanner → Connector → 
   [Auth modules] → DeepScanner/VulnerabilityScanner → finder → HTML files
   ```

2. **Экспорт**:
   ```
   HTML files → ResultExporter → JSON/CSV files
   ```

3. **Статистика**:
   ```
   Global counters → ProgressMonitor → Console output
   ```

4. **Мониторинг**:
   ```
   NetworkMonitor → ConfigManager → MainStarter → [Scanning] → Snapshot comparison
   ```

5. **Интерактивный режим**:
   ```
   InteractiveMode → ConfigManager → MainStarter → [Scanning]
   ```

## Сборка

Проект использует Qt qmake для сборки:
- **nesca.pro** - для console mode
- **nesca_3.pro** - для GUI mode

Компиляция создает:
- Исполняемый файл
- MOC файлы (moc_*.cpp)
- UI заголовки (ui_*.h)
- QRC файлы (qrc_*.cpp)

## Рекомендации для разработчиков

1. **Новые модули аутентификации**: Добавляйте в `src/auth/`

2. **Новые детекторы**: Добавляйте в `src/detectors/`

3. **Новые утилиты**: Добавляйте в корень или создайте `src/utils/`

4. **Новые сетевые модули**: Добавляйте в `src/network/`

5. **Тесты**: Помещайте в директорию `tests/`

6. **Документация**: Всегда обновляйте соответствующие .md файлы в `docs/`

7. **Константы**: Используйте `mainResources.h` для констант, связанных с типами устройств

8. **Глобальные переменные**: Добавляйте в `externData.h` только при необходимости

9. **Конфигурация**: Новые параметры сканирования добавляйте в `ConfigManager`

10. **Профили**: Новые профили можно добавить в `ConfigManager::initializeDefaultProfiles()`

## Зависимости

- **Qt5 Core/Network** - основные библиотеки
- **libssh** - SSH подключения
- **OpenSSL** - SSL/TLS
- **libcurl** - HTTP запросы

## Архитектурные особенности

### Модульность
Проект организован в модули, каждый из которых отвечает за свою функциональность:
- **Core** - ядро системы
- **Auth** - модули аутентификации
- **Network** - сетевая функциональность
- **Detectors** - обнаружение и анализ
- **Export** - экспорт результатов
- **UI** - пользовательский интерфейс

### Конфигурация
Система конфигурации позволяет:
- Сохранять настройки в файлах
- Использовать предустановленные профили
- Объединять настройки из разных источников
- Валидировать конфигурацию

### Адаптивность
Адаптивное сканирование обеспечивает:
- Автоматическую оптимизацию производительности
- Мониторинг состояния сети
- Динамическую корректировку параметров

### Расширяемость
Легко добавить:
- Новые модули аутентификации
- Новые детекторы уязвимостей
- Новые профили сканирования
- Новые форматы экспорта
- Новые быстрые пресеты

## Следующие шаги для улучшения структуры

- [x] Организовать исходники в поддиректории (src/core, src/auth, src/export, src/detectors)
- [ ] Создать CMakeLists.txt для альтернативной сборки
- [ ] Добавить unit-тесты
- [ ] Создать конфигурационные файлы для CI/CD
- [ ] Добавить примеры использования в docs/examples/
- [ ] Рефакторинг: перенести все модули в src/

